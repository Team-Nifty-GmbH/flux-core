const s=navigator.serviceWorker.ready;document.addEventListener("DOMContentLoaded",function(){initSW()});window.initSW=function(){if(!1 in navigator||!1 in window)return;navigator.serviceWorker.register("/pwa-service-worker").then(n=>{a()})};function a(){s&&new Promise(function(e,t){const n=Notification.requestPermission(function(r){e(r)});n&&n.then(e,t)}).then(e=>{e==="granted"&&c()})}function c(){s.then(e=>{const t={userVisibleOnly:!0,applicationServerKey:l(document.head.querySelector('meta[name="webpush-key"]').content)};return e.pushManager.subscribe(t)}).then(e=>{u(e)}).catch(e=>{console.log("Failed to subscribe the user: ",e)})}function u(e){const t=document.querySelector("meta[name=csrf-token]").getAttribute("content");fetch("/push-subscription",{method:"POST",body:JSON.stringify(e),headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-Token":t}}).then(n=>n.json())}function l(e){let t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(n),o=new Uint8Array(r.length);for(let i=0;i<r.length;++i)o[i]=r.charCodeAt(i);return o}
